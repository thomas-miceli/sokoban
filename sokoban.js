$(document).ready(function () {

    function Sokoban () {
        this.level = 0;                 // L'id du niveau
        this.tableGrid = [];            // La grille de jeu
        this.playerPos = {x: 0, y: 0};  // Position actuelle du joueur
        this.direction = {x: 0, y: 0};  // La direction en fonction de ZQSD
        this.goals = [];                // Array d'objets de chaque position des points d'arrivée {x: x, y: y}
        this.won = false;               // Si le niveau est gagné ou non

        this.color = function (pos, color) {
            let tr = $($("tr")[pos.y]);
            let td = $($("td", tr)[pos.x]);
            td.css('background-color', color)
        };

        this.creerTable = function (obj, lvl) {
            this.level = lvl;
            $('h2').html('Niveau ' + this.level);

            $('#game').empty(); // Vidage de la grille dans le DOM

            let table = $('<table cellspacing="0"></table>').css({'border': '1px solid black','table-layout':' fixed'}).appendTo('#game'); // Style

            let i = 0;
            for (let ob of obj.cells) {
                this.tableGrid[i] = []; // Initialisation du tableau en 2D
                let tr = $('<tr />').appendTo(table); // Ajout de chaque ligne au DOM ...
                for (let j = 0; j < ob.length; j++) {
                    $('<td />').appendTo(tr).css({'height': '30px','width': '30px', 'color': 'rgba(0, 0, 0, 0)'}); // ... ainsi que les colonnes
                    this.tableGrid[i][j] = ob[j] !== " " || undefined ? ob[j] : '+'; // Si case vide du tableau, on remplace par un + dans notre tableau

                    // Définition des couleurs à afficher + positions joueur & objectifs
                    switch (ob[j]) {
                        case '#': // mur
                            this.color({x:j, y:i}, 'gray'); break;
                        case '@': // joueur
                            this.playerPos.y = i;
                            this.playerPos.x = j;
                            this.color({x:j, y:i}, 'red'); break;
                        case '.': // point d'arrivée
                            this.goals.push({x:j, y:i})
                            this.color({x:j, y:i}, 'gold'); break;
                        case '*': // bloc sur un point d'arrivée
                            this.goals.push({x:j, y:i})
                            this.color({x:j, y:i}, 'darkcyan'); break;
                        case '$': // bloc
                            this.color({x:j, y:i}, 'cyan'); break;
                    }
                }
                i++;
            }
        };

        this.checkMove = function (move) {
            switch (move) {
                case 122: // Haut Z
                    this.direction = {x:0, y:-1};
                    break;

                case 113: // Gauche Q
                    this.direction = {x:-1, y:0};
                    break;

                case 115: // Bas S
                    this.direction = {x:0, y:1};
                    break;

                case 100: // Droite D
                    this.direction = {x:1, y:0};
                    break;
            }

            // Code assez verbeux mais évite de le dupliquer 4 fois
            if (this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] === '#' || ((this.tableGrid[this.playerPos.y + (this.direction.y + this.direction.y)][this.playerPos.x + (this.direction.x + this.direction.x)] === '#' || (this.tableGrid[this.playerPos.y + (this.direction.y + this.direction.y)][this.playerPos.x + (this.direction.x + this.direction.x)] === '$' || this.tableGrid[this.playerPos.y + (this.direction.y + this.direction.y)][this.playerPos.x + (this.direction.x + this.direction.x)] === '*')) && (this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] === '$' || this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] === '*'))) {
                ;
            } else if (this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] === '$' || this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] === '*') {
                this.tableGrid[this.playerPos.y][this.playerPos.x] = '+';
                this.tableGrid[this.playerPos.y + (this.direction.y + this.direction.y)][this.playerPos.x + (this.direction.x + this.direction.x)] = '$';
                this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] = '@';
                this.playerPos.x += this.direction.x;
                this.playerPos.y += this.direction.y;
                this.color({x:this.playerPos.x, y:this.playerPos.y}, 'red');
                this.color({x:this.playerPos.x-this.direction.x, y:this.playerPos.y-this.direction.y}, 'white');
            } else {
                this.tableGrid[this.playerPos.y][this.playerPos.x] = '+';
                this.tableGrid[this.playerPos.y + this.direction.y][this.playerPos.x + this.direction.x] = '@';
                this.playerPos.x += this.direction.x;
                this.playerPos.y += this.direction.y;
                this.color({x:this.playerPos.x, y:this.playerPos.y}, 'red');
                this.color({x:this.playerPos.x-this.direction.x, y:this.playerPos.y-this.direction.y}, 'white');
            }

            if (!this.won) {
                this.won = true;
                for (let goal of this.goals) {
                    if (this.tableGrid[goal.y][goal.x] === '$') this.tableGrid[goal.y][goal.x] = '*';

                    // Après que le joueur soit passé dessus, on la redéfinit dans le tableau (aspect visuel)
                    if (this.tableGrid[goal.y][goal.x] === '+') this.tableGrid[goal.y][goal.x] = '.'

                    // Si un bloc n'est pas sur le point d'arrivée
                    if (this.tableGrid[goal.y][goal.x] !== '*') this.won = false;
                }
            }

            // Redéfinition de certaines couleurs
            for (let i = 0; i < this.tableGrid.length; ++i) {
                for (let j = 0; j < this.tableGrid[i].length; ++j) {
                    if (this.tableGrid[i][j] === '$') this.color({y:i,x:j}, 'cyan');
                    if (this.tableGrid[i][j] === '.') this.color({y:i,x:j}, 'gold');
                    if (this.tableGrid[i][j] === '*') this.color({y:i,x:j}, 'darkcyan');
                }
            }
        }
    }

    let json = {"copyright":"ASCII Corporation","description":"60 levels original MSX version of Sokoban - 1984","levels":[{"cells":["    #####","    #   #","    #$  #","  ###  $###","  #  $  $ #","### # ### #     ######","#   # ### #######  ..#","# $  $             ..#","##### #### #@####  ..#","    #      ###  ######","    ########"],"height":11,"id":"1","total_balls":6,"width":22},{"cells":["############","#..  #     ###","#..  # $  $  #","#..  #$####  #","#..    @ ##  #","#..  # #  $ ##","###### ##$ $ #","  # $  $ $ $ #","  #    #     #","  ############"],"height":10,"id":"2","total_balls":10,"width":14},{"cells":["        ########","        #     @#","        # $#$ ##","        # $  $#","        ##$ $ #","######### $ # ###","#....  ## $  $  #","##...    $  $   #","#....  ##########","########"],"height":10,"id":"3","total_balls":11,"width":17},{"cells":["              ########","              #  ....#","   ############  ....#","   #    #  $ $   ....#","   # $$$#$  $ #  ....#","   #  $     $ #  ....#","   # $$ #$ $ $########","####  $ #     #","#   # #########","#    $  ##","# $$#$$ @#","#   #   ##","#########"],"height":13,"id":"4","total_balls":20,"width":22},{"cells":["        #####","        #   #####","        # #$##  #","        #     $ #","######### ###   #","#....  ## $  $###","#....    $ $$ ##","#....  ##$  $ @#","#########  $  ##","        # $ $  #","        ### ## #","          #    #","          ######"],"height":13,"id":"5","total_balls":12,"width":17},{"cells":["######  ###","#..  # ##@##","#..  ###   #","#..     $$ #","#..  # # $ #","#..### # $ #","#### $ #$  #","   #  $# $ #","   # $  $  #","   #  ##   #","   #########"],"height":11,"id":"6","total_balls":10,"width":12},{"cells":["       #####"," #######   ##","## # @## $$ #","#    $      #","#  $  ###   #","### #####$###","# $  ### ..#","# $ $ $ ...#","#    ###...#","# $$ # #...#","#  ### #####","####"],"height":12,"id":"7","total_balls":11,"width":13},{"cells":["  ####","  #  ###########","  #    $   $ $ #","  # $# $ #  $  #","  #  $ $  #    #","### $# #  #### #","#@#$ $ $  ##   #","#    $ #$#   # #","##  $    $ $ $ #"," ####  #########","  ###  ###","  #      #","  #      #","  #......#","  #......#","  #......#","  ########"],"height":17,"id":"8","total_balls":18,"width":16},{"cells":["          #######","          #  ...#","      #####  ...#","      #      ...#","      #  ##  ...#","      ## ##  ...#","     ### ########","     # $$$ ##"," #####  $ $ #####","##   #$ $   #   #","#@ $  $    $  $ #","###### $$ $ #####","     # $    #","     #### ###","        #  #","        #  #","        #  #","        ####"],"height":18,"id":"9","total_balls":15,"width":17},{"cells":["              ####","         ######  #","         #       #","         #  #### ###"," ###  ##### ###    #","##@####   $$$ #    #","# $$   $$ $   #....##","#  $$$#    $  #.....#","# $   # $$ $$ #.....#","###   #  $    #.....#","  #   # $ $ $ #.....#","  # ####### ###.....#","  #   #  $ $  #.....#","  ### # $$ $ $#######","    # #  $      #","    # # $$$ $$$ #","    # #       # #","    # ######### #","    #           #","    #############"],"height":20,"id":"10","total_balls":34,"width":21},{"cells":["          ####","     #### #  #","   ###  ###$ #","  ##   @  $  #"," ##  $ $$## ##"," #  #$##     #"," # # $ $$ # ###"," #   $ #  # $ #####","####    #  $$ #   #","#### ## $         #","#.    ###  ########","#.. ..# ####","#...#.#","#.....#","#######"],"height":15,"id":"11","total_balls":14,"width":19},{"cells":["  #########","  #*.*#*.*#","  #.*.*.*.#","  #*.*.*.*#","  #.*.*.*.#","  #*.*.*.*#","  ###   ###","    #   #","###### ######","#           #","# $ $ $ $ $ #","## $ $ $ $ ##"," #$ $ $ $ $#"," #   $@$   #"," #  #####  #"," ####   ####"],"height":16,"id":"12","total_balls":34,"width":13},{"cells":["    #########","  ###   ##  #####","###      #  #   ####","#  $$ #$ #  #  ... #","# #  $#@$## # #.#. #","#  ## #$  #    ... #","# $#    $ # # #.#. #","#    ##  ##$ $ ... #","# $ ##   #  #$#.#. #","## $$  $   $  $... #"," #$  ######    ##  #"," #   #    ##########"," #####"],"height":13,"id":"13","total_balls":18,"width":20},{"cells":["################","#              #","# # ######     #","# #  $ $ $ $#  #","# #   $@$   ## ##","# # #$ $ $###...#","# #   $ $  ##...#","# ###$$$ $ ##...#","#     # ## ##...#","#####   ## ##...#","    #####     ###","        #     #","        #######"],"height":13,"id":"14","total_balls":15,"width":17},{"cells":["       ####","    ####  #","   ##  #  #","   #  $ $ #"," ### #$   ####"," #  $  ##$   #"," #  # @ $ # $#"," #  #      $ ####"," ## ####$##     #"," # $#.....# #   #"," #  $...*. $# ###","##  #.....#   #","#   ### #######","# $$  #  #","#  #     #","######   #","     #####"],"height":17,"id":"15","total_balls":15,"width":17},{"cells":["#####","#   ##","#    #  ####","# $  ####  #","#  $$ $   $#","###@ #$    ##"," #  ##  $ $ ##"," # $  ## ## .#"," #  #$##$  #.#"," ###   $..##.#","  #    #.*...#","  # $$ #.....#","  #  #########","  #  #","  ####"],"height":15,"id":"16","total_balls":15,"width":14},{"cells":["       #######"," #######     #"," #     # $@$ #"," #$$ #   #########"," # ###......##   #"," #   $......## # #"," # ###......     #","##   #### ### #$##","#  #$   #  $  # #","#  $ $$$  # $## #","#   $ $ ###$$ # #","#####     $   # #","    ### ###   # #","      #     #   #","      ########  #","             ####"],"height":16,"id":"17","total_balls":18,"width":18},{"cells":["      ############","      #  .  ##   #","      # #.     @ #"," ###### ##...# ####","##  ##...####     ####","# $ ##...    $ #  $  #","#     .. ## # ## ##  #","####$###$# $  #   # ##"," ###  #    ##$ $$ # #"," #   $$ # # $ # $## #"," #                  #"," #################  #","                 ####"],"height":13,"id":"18","total_balls":13,"width":22},{"cells":["        ######","        #   @####","      ##### $   #","      #   ##    ####","      # $##  ##    #","      #   #  ##### #","      # #$$ $    # #","      #  $ $ ### # #","      # #   $  # # #","      # #  #$#   # #","     ## ####   # # #","     #  $  ##### # # ####","    ##    $     $  ###  ####","#####  ### $ $# $ #   .....#","#     ##      #  ##  #.....#","# $$$$    ######$##   #.##.#","##    ##              #....#"," ##  ###############   ....#","  #  #             #####  ##","  ####                 ####"],"height":20,"id":"19","total_balls":20,"width":28},{"cells":["       ############","       #..........#","     ###.#.#.#.#..#","     #   .........#","     #@ $ $ $ *.*.#","    ####### #######"," ####   #    ##  #","##    $ #    # $ ##","#  #$# ### ###$   ##","# $  $ $   # $ $ $ #","#  # $ ##       #$ #","#   $####$####$##  #","####  ##   #    #  #","   #$ ##   # # $$  #","   #   # $ #  $    #","   ### # $$ #  $ ###","     # #    # $ ##","     # ######## #","     #          #","     ############"],"height":20,"id":"20","total_balls":29,"width":20},{"cells":["   ##########","   #..  #   #","   #..      #","   #..  #  ####","  #######  #  ##","  #            #","  #  #  ##  #  #","#### ##  #### ##","#  $  ##### #  #","# # $  $  # $  #","# @$  $   #   ##","#### ## #######","   #    #","   ######"],"height":14,"id":"21","total_balls":6,"width":16},{"cells":["            ####"," ############  #####"," #    #  #  $  #   ##"," # $ $ $  $ # $ $   #"," ##$ $   # @# $   $ #","###   ############ ##","#  $ $#  #......# $#","# #   #  #......## #","#  ## ## # .....#  #","# #      $...... $ #","# # $ ## #......#  #","#  $ $#  #......# $#","# $   #  ##$#####  #","# $ $ #### $ $  $ $#","## #     $ $ $ $   ###"," #  ###### $    $    #"," #         # ####### #"," ####### #$          #","       #   ###########","       #####"],"height":20,"id":"22","total_balls":35,"width":22},{"cells":["       #######","       #  #  ####","       # $#$ #  ##","########  #  #   ########","#....  # $#$ #  $#  #   #","#....# #     #$  #      #","#..#.    $#  # $    #$  #","#... @##  #$ #$  #  #   #","#.... ## $#     $########","########  #$$#$  #","       # $#  #  $#","       #  #  #   #","       ####  #####","          ####"],"height":14,"id":"23","total_balls":18,"width":25},{"cells":["   ##########","   #........####","   #.#.#....#  #","   #........$$ #","   #     .###  ####"," #########  $ #   #"," #     $   $ $  $ #"," #  #    #  $ $#  #"," ## #####   #  #  #"," # $     #   #### #","##  $#   # ##  #  #","#    ##$###    #  ##","# $    $ #  #  #   #","#####    # ## # ## ##","    #$# #  $  $ $   #","    #@#  $#$$$  #   #","    ###  $      #####","      ##  #  #  #","       ##########"],"height":19,"id":"24","total_balls":23,"width":21},{"cells":["               ####","          ######  #####","    #######       #   #","    #      $ $ ## # # #","    #  #### $  #     .#","    #      $ # # ##.#.#","    ##$####$ $ $ ##.#.#","    #     #    ####.###","    # $   ######  #.#.#","######$$$##      @#.#.#","#      #    #$#$###. .#","# #### #$$$$$    # ...#","# #    $     #   # ...#","# #   ## ##     ###...#","# ######$######  ######","#        #    #  #","##########    ####"],"height":17,"id":"25","total_balls":21,"width":23},{"cells":["#########","#       #","#       ####","## #### #  #","## #@##    #","# $$$ $  $$#","#  # ## $  #","#  # ##  $ ####","####  $$$ $#  #"," #   ##   ....#"," # #   # #.. .#"," #   # # ##...#"," ##### $  #...#","     ##   #####","      #####"],"height":15,"id":"26","total_balls":13,"width":15},{"cells":[" #################"," #...   #    #   ###","##.....  $## # # $ #","#......#  $  #  $  #","#......#  #  # # # ##","######### $  $ # #  ###","  #     #$##$ ## ##   #"," ##   $    # $  $   # #"," #  ## ### #  #####$# #"," # $ $$     $   $     #"," # $    $##$ ######## #"," #######  @ ##      ###","       ######"],"height":13,"id":"27","total_balls":20,"width":23},{"cells":["     #######","     #@ #  #","     # $   #","    ### ## #"," #### $  # ##"," #       #  ##"," # $ $#### $ #"," # $$ #  #  $#"," #$  $   #$  #","##  $$#   $$ ##","# $$  #  #  $ #","#     #### $  #","#  #$##..##   #","### .#....#####","  # .......##","  #....   ..#","  ###########"],"height":17,"id":"28","total_balls":20,"width":15},{"cells":["                #####","       ###### ###   ####","   #####    ### $ $  $ #","####  ## #$ $    $ #   #","#....   $$ $ $  $   #$##","#.. # ## #   ###$## #  #","#....    # ###    #    #","#....    # ##  $  ###$ #","#..######  $  #  #### ##","####    #   ###    @  #","        ###############"],"height":11,"id":"29","total_balls":16,"width":24},{"cells":[" #####"," #   #######"," # $ ###   #"," # $    $$ #"," ## ####   #","### #  # ###","#   #  #@##","# $$    $ #","#   # # $ ####","##### #   #  #"," #   $####   #"," #  $     $  #"," ##   ##### ##"," ##########  #","##....# $  $ #","#.....# $$#  #","#.. ..# $  $ #","#.....$   #  #","##  ##########"," ####"],"height":20,"id":"30","total_balls":18,"width":14},{"cells":[" #######"," #  #  #####","##  #  #...###","#  $#  #...  #","# $ #$$ ...  #","#  $#  #... .#","#   # $########","##$       $ $ #","##  #  $$ #   #"," ######  ##$$@#","      #      ##","      ########"],"height":12,"id":"31","total_balls":13,"width":15},{"cells":["  ####","  #  #########"," ##  ## @#   #"," #  $# $ $   ####"," #$  $  # $ $#  ##","##  $## #$ $     #","#  #  # #   $$$  #","# $    $  $## ####","# $ $ #$#  #  #","##  ###  ###$ #"," #  #....     #"," ####......####","   #....####","   #...##","   #...#","   #####"],"height":16,"id":"32","total_balls":20,"width":18},{"cells":["      ####","  #####  #"," ##     $#","## $  ## ###","#@$ $ # $  #","#### ##   $#"," #....#$ $ #"," #....#   $#"," #....  $$ ##"," #... # $   #"," ######$ $  #","      #   ###","      #$ ###","      #  #","      ####"],"height":15,"id":"33","total_balls":15,"width":13},{"cells":["############","##     ##  #","##   $   $ #","#### ## $$ #","#   $ #    #","# $$$ # ####","#   # # $ ##","#  #  #  $ #","# $# $#    #","#   ..# ####","####.. $ #@#","#.....# $# #","##....#  $ #","###..##    #","############"],"height":15,"id":"34","total_balls":15,"width":12},{"cells":["############  ######","#   #    #@####....#","#   $$#       .....#","#   # ###   ## ....#","## ## ###  #   ....#"," # $ $     # ## ####"," #  $ $##  #       #","#### #  #### ## ## #","#  # #$   ## ##    #","# $  $  # ## #######","# # $ $    # #","#  $ ## ## # #","# $$     $$  #","## ## ### $  #"," #    # #    #"," ###### ######"],"height":16,"id":"35","total_balls":17,"width":20},{"cells":["     ####","   ###  ##","####  $  #","#   $ $  ####","# $   # $   # ####","#  #  #   $ # #..#","##$#$ ####$####..#"," #   ##### ## ...#"," #$# ##@## ##  ..#"," # #    $     ...#"," #   #### ###  ..#"," ### ## #  ## ...#","  ##$ ####$ ###..#","  #   ##    # #..#"," ## $$##  $ # ####"," #     $$$$ #"," # $ ###    #"," #   # ######"," #####"],"height":19,"id":"36","total_balls":21,"width":18},{"cells":["###########","#......   #########","#......   #  ##   #","#..### $    $     #","#... $ $ #  ###   #","#...#$#####    #  #","###    #   #$  # $###","  #  $$ $ $  $##  $ #","  #  $   #$#  ##    #","  ### ## #  $ #######","   #  $ $ ## ##","   #    $  $  #","   ##   # #   #","    #####@#####","        ###"],"height":15,"id":"37","total_balls":20,"width":21},{"cells":[" #########"," #....   ##"," #.#.#  $ ##","##....# # @##","# ....#  #  ##","#     #$ ##$ #","## ###  $    #"," #$  $ $ $#  #"," # #  $ $ ## #"," #  ###  ##  #"," #    ## ## ##"," #  $ #  $  #"," ###$ $   ###","   #  #####","   ####"],"height":15,"id":"38","total_balls":14,"width":14},{"cells":["              ###","             ##.###","             #....#"," #############....#","##   ##     ##....#####","#  $$##  $ @##....    #","#      $$ $#  ....#   #","#  $ ## $$ # #....#  ##","#  $ ## $  # ## ###  #","## ##### ###         #","##   $  $ ##### ###  #","# $###  # ##### # ####","#   $   #       #","#  $ #$ $ $###  #","# $$$# $   # ####","#    #  $$ #","######   ###","     #####"],"height":18,"id":"39","total_balls":25,"width":23},{"cells":["      ####","####### @#","#     $  #","#   $## $#","##$#...# #"," # $...  #"," # #. .# ##"," #   # #$ #"," #$  $    #"," #  #######"," ####"],"height":11,"id":"40","total_balls":8,"width":11},{"cells":["           #####","          ##   ##","         ##     #","        ##  $$  #","       ## $$  $ #","       # $    $ #","####   #   $$ #####","#  ######## ##    #","#..           $$$@#","#.# ####### ##   ##","#.# #######. #$ $###","#........... #   $ #","##############  $  #","             ##  ###","              ####"],"height":15,"id":"41","total_balls":16,"width":20},{"cells":[" ########"," #@##   ####"," # $   $   #"," #  $ $ $$$#"," # $$# #   #","##$    $   #","#  $  $$$$$##","# $#### #   #","#  $....#   #","# ##....#$$ #","# ##....   ##","#   ....#  #","## #....#$$#"," # #....#  #"," #         #"," #### ##$###","    #    #","    ######"],"height":18,"id":"42","total_balls":24,"width":13},{"cells":["    ############","    #          ##","    #  # #$$ $  #","    #$ #$#  ## @#","   ## ## # $ # ##","   #   $ #$  # #","   #   # $   # #","   ## $ $   ## #","   #  #  ##  $ #","   #    ## $$# #","######$$   #   #","#....#  ########","#.#... ##","#....   #","#....   #","#########"],"height":16,"id":"43","total_balls":16,"width":17},{"cells":["      ######","   #####   #","   #   # # #####","   # $ #  $    ######","  ##$  ### ##       #","###  $$ $ $ #  ##   #####","#       $   ###### ##   #","#  ######## #@   # #  # #","## ###      #### #$# #  #"," # ### #### ##.. #   $ ##"," #  $  $  #$##.. #$##  ##"," #  # # #     ..## ## $ #"," ####   # ## #..#    $  #","    #####    #..# # #  ##","        ######..#   # ##","             #..#####  #","             #..       #","             ##  ###  ##","              #########"],"height":19,"id":"44","total_balls":16,"width":25},{"cells":["        #######","    #####  #  ####","    #   #   $    #"," #### #$$ ## ##  #","##      # #  ## ###","#  ### $#$  $  $  #","#...    # ##  #   #","#...#    @ # ### ##","#...#  ###  $  $  #","######## ##   #   #","          #########"],"height":11,"id":"45","total_balls":9,"width":19},{"cells":["    #########  ####","    #   ##  ####  #","    #   $   #  $  #","    #  # ## #     ####","    ## $   $ $$# #   #","    ####  #  # $ $   #","#####  ####    ###...#","#   #$ #  # ####.....#","#      #  # # ##.....#","###### #  #$   ###...#","   #   ## # $#   #...#","  ##       $  $# #####"," ## $$$##  # $   #"," #   #  # ###  ###"," #   $  #$ @####"," #####  #   #","     ########"],"height":17,"id":"46","total_balls":19,"width":22},{"cells":[" #####"," #   #"," # # ######"," #      $@######"," # $ ##$ ###   #"," # #### $    $ #"," # ##### #  #$ ####","##  #### ##$      #","#  $#  $  # ## ## #","#         # #...# #","######  ###  ...  #","     #### # #...# #","          # ### # #","          #       #","          #########"],"height":15,"id":"47","total_balls":9,"width":19},{"cells":["       ####","       #  ##","       #   ##","       # $$ ##","     ###$  $ ##","  ####    $   #","###  # #####  #","#    # #....$ #","# #   $ ....# #","#  $ # #.*..# #","###  #### ### #","  #### @$  ##$##","     ### $     #","       #  ##   #","       #########"],"height":15,"id":"48","total_balls":12,"width":16},{"cells":["      ############","     ##..    #   #","    ##..* $    $ #","   ##..*.# # #$ ##","   #..*.# # # $  #","####...#  #    # #","#  ## #          #","# @$ $ ###  # # ##","# $   $   # #   #","###$$   # # # # #","  #   $   # # #####","  # $# #####      #","  #$   #   #   #  #","  #  ###   ##     #","  #  #      #    ##","  ####      ######"],"height":16,"id":"49","total_balls":16,"width":19},{"cells":["     #############","     #    ###    #","     #     $ $  ####","   #### #   $ $    #","  ## $  #$#### $ $ #","###   # #   ###  $ #","# $  $  #  $  # ####","# ##$#### #$#  $  ###","# ##  ### # # #  $  #","#    @$   $   # $ # #","#####  #  ##  # $#  #","  #... #####$  #  # #","  #.......# $$ #$ # #","  #.......#         #","  #.......#######  ##","  #########     ####"],"height":16,"id":"50","total_balls":24,"width":21},{"cells":["##### ####","#...# #  ####","#...###  $  #","#....## $  $###","##....##   $  #","###... ## $ $ #","# ##    #  $  #","#  ## # ### ####","# $ # #$  $    #","#  $ @ $    $  #","#   # $ $$ $ ###","#  ######  ###","# ##    ####","###"],"height":14,"id":"51","total_balls":17,"width":16},{"cells":[" ####","##  #####","#       # #####","# $###  ###   #","#..#  $# #  # #","#..#      $$# ###","#.*# #  #$ $    #####","#..#  ##     ##$#   #","#.*$  $ # ##  $     #","#..##  $   #   ######","#.*##$##   #####","#..  $ #####","#  # @ #","########"],"height":14,"id":"52","total_balls":16,"width":21},{"cells":["   ##########","   #  ###   #","   # $   $  #","   #  ####$##","   ## #  #  #","  ##  #.*   #","  #  ##..#  #","  # @ #.*# ##","  # #$#..#$ #","  # $ #..#  #","  # # #**#  #","  # $ #..#$##","  #    .*#  #"," ###  #  #  #","##    ####  #","#  #######$##","# $      $  #","#  ##   #   #","#############"],"height":19,"id":"53","total_balls":16,"width":13},{"cells":[" #####################"," #   ##  #   #   #   #"," # $     $   $   $   ##","##### #  #   ### ##$###","#   # ##$######   #   #","# $   # ......#   # $ #","## #  # ......#####   #","## #########..#   # ###","#          #..# $   #","# ## ### ###..## #  ###","# #   #   ##..## ###  #","#   @      $..#       #","# #   #   ##  #   ##  #","##### ############## ##","#          #   #    $ #","# $  # $ $ $   # #    #","# #$## $#  ## ##    # #","#  $ $$ #### $  $ # # #","#          #   #      #","#######################"],"height":20,"id":"54","total_balls":22,"width":23},{"cells":[" #####################","##                   #","#    $ #      ## #   #","#  ###### ###  #$## ##","##$#   ##$#....   # #","#  #    $ #....## # #","# $ # # # #....##   #","# $ #$$   #....##$# #","# # $@$##$#....##   #","#   $$$   #....#    #","#  $#   # ###### $###","##  # ###$$  $   $ #","##     # $  $ ##   #"," #####   #   #######","     #########"],"height":15,"id":"55","total_balls":24,"width":22},{"cells":["##########","#        ####","# ###### #  ##","# # $ $ $  $ #","#       #$   #","###$  $$#  ###","  #  ## # $##","  ##$#   $ @#","   #  $ $ ###","   # #   $  #","   # ##   # #","  ##  ##### #","  #         #","  #.......###","  #.......#","  #########"],"height":16,"id":"56","total_balls":14,"width":14},{"cells":["         ####"," #########  ##","##  $      $ #####","#   ## ##   ##...#","# #$$ $ $$#$##...#","# #    @  #   ...#","#  $# ###$$   ...#","# $  $$  $ ##....#","###$       #######","  #  #######","  ####"],"height":11,"id":"57","total_balls":16,"width":18},{"cells":["              ######","          #####    #","          #  ## #  #####","          #   *.#..#   #"," ##### #### $#.#...    #"," #   ###  ## #*....## ##"," # $      ## #..#..## #","###### #   # #*.##### #","#   # $#$# # #..##### #","# $  $     # #*.    # #","## ##  $ ### #  ##  # #"," #  $  $ ### ##### ## #"," ###$###$###  #### ## #","#### #         ###  # #","#  $ #  $####  ###$$#@#####","#      $ # #  ####  #$#   #","#### #  $# #              #","   #  $  # ##  ##  ########","   ##  ###  ########","    ####"],"height":20,"id":"58","total_balls":23,"width":27},{"cells":["         ####","         #  #","         #  ########","   #######  #      #","   #   # # # # #   ##","   # $     $  ##  $ #","  ### $# #  # #     #########","  #  $  #  $# # $$ #   # #  #"," ## #   #     ###    $ # #  #"," #  #$   # ###  #  # $$# #  #"," #    $## $  #   ## $  # # ##","####$ $ #    ##  #   $    ..#","#  #    ### # $ $ ###  ###.*#","#     ##  $$ @  $     ##....#","#  ##  ##   $  #$#  ##....*.#","## #  $  # # $##  ##....*.###","## ##  $  # $ #  #....*.###","#    $ ####   # ....*.###","#   #  #  #  #  ..*.###","########  ###########"],"height":20,"id":"59","total_balls":36,"width":29},{"cells":["        #####","        #   ####","        # $    ####  ####","        #   # $#  ####  #","########### #   $   #   #","#..     # $  #### #  #  #","#..$  #   $  #  $ # $ .##","#.*# # $ $ ##  ##    #.#","#..#$ @ #   ##    $$ #.#","#..# $ $  $ $ ##   ## .#","#.*$$ # ##   $ #$# $ #.#","#..#      ##   #     #.#","#..#######  ### ######.##","# $$                  *.##","#  ##################  ..#","####                ######"],"height":16,"id":"60","total_balls":27,"width":26},{"cells":["######","#@ $ .#","######"],"height":3,"id":"61","total_balls":1,"width":7},{"cells":["######","#@ $ .#","######"],"height":3,"id":"62","total_balls":1,"width":7},{"cells":["######","#@ $ .#","######"],"height":3,"id":"63","total_balls":1,"width":7}],"max_height":20,"max_width":29,"title":"Spiros 05","total":60};
    let sokoban;
    let levelSelected = false;

    function updateButtons() {
        $('#btn').empty();
        for (let i = 0; i < json.levels.length; i++) {
            let btn = $('<button />').css('border', '1px solid black').append('LVL ' + (i+1)).appendTo('#btn');

            if (getCookieLvl(i+1)) btn.css('background-color', 'green');

            btn.click(function () {
                levelSelected = true;
                sokoban = new Sokoban();
                sokoban.creerTable(json.levels[i], json.levels[i].id);
            });
        }
    }

    updateButtons();

    $(document).keypress(function(e) {
        if (levelSelected) {
            sokoban.checkMove(e.which);
            if (sokoban.won) {
                alert('gg');
                if (!getCookieLvl(sokoban.level)) {
                    setCookie(getCookie() + ',' + sokoban.level);
                    updateButtons();
                }
            }
        }
    });
});